server:
  port: 8080

spring:
  application:
    name: telemetry-bridge

  kafka:
    producer:
      key-serializer: org.springframework.kafka.support.serializer.JsonSerializer
      value-serializer: org.springframework.kafka.support.serializer.StringOrBytesSerializer

  main:
    web-application-type: reactive

  cloud:
    function:
      definition: mqttSource|mqttToKafka

    stream:
      default-binder: kafka

      bindings:
        "mqttSource|mqttToKafka-out-0":
          destination: iot.plant.events.raw

      kafka:
        binder:
          bootstrap-servers: ${SPRING_KAFKA_BOOTSTRAP_SERVERS:kafka:9092}
          producer:
            key-serializer: org.springframework.kafka.support.serializer.JsonSerializer
            value-serializer: org.springframework.kafka.support.serializer.StringOrBytesSerializer
            properties:
              acks: all
              enable.idempotence: true
              max.in.flight.requests.per.connection: 5
              retries: 10
          auto-create-topics: true
          configuration:
            acks: all
            linger.ms: 5

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,env
  endpoint:
    health:
      show-details: always

logging:
  level:
    root: INFO
    org.springframework.cloud.stream: INFO
    reactor.kafka: WARN

app:
  mqtt:
    # IMPORTANT: must include scheme
    broker-uri: ${APP_MQTT_BROKER_URI:tcp://${APP_MQTT_HOST:localhost}:${APP_MQTT_PORT:1883}}
    client-id: ${APP_MQTT_CLIENT_ID:telemetry-bridge}
    topic: ${APP_MQTT_TOPIC:mqtt.internal.telemetry}
    qos: ${APP_MQTT_QOS:1}
    username: ${APP_MQTT_USERNAME:}
    password: ${APP_MQTT_PASSWORD:}
